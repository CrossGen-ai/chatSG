<!DOCTYPE html>
<html>
<head>
    <title>Frontend Streaming Debug</title>
</head>
<body>
    <h1>Testing Frontend Streaming</h1>
    <p>Open the browser console and check for streaming logs</p>
    <script>
        console.log('Testing streaming directly from frontend code...');
        
        // Import the streaming function
        async function testStreaming() {
            const message = 'Hello, test streaming from frontend';
            const sessionId = 'frontend-test-' + Date.now();
            
            console.log('[TEST] Sending streaming request:', { message, sessionId });
            
            // Simulate the frontend streaming call
            fetch('http://localhost:5173/api/chat/stream', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ message, sessionId })
            }).then(response => {
                console.log('[TEST] Response:', response);
                console.log('[TEST] Response headers:', response.headers.get('content-type'));
                
                const reader = response.body?.getReader();
                const decoder = new TextDecoder();
                let buffer = '';
                
                const processChunk = async () => {
                    const { done, value } = await reader.read();
                    if (done) {
                        console.log('[TEST] Stream done');
                        return;
                    }
                    
                    const chunk = decoder.decode(value, { stream: true });
                    console.log('[TEST] Chunk:', chunk);
                    buffer += chunk;
                    
                    const lines = buffer.split('\n');
                    buffer = lines.pop() || '';
                    
                    for (const line of lines) {
                        if (line.startsWith('event: ')) {
                            console.log('[TEST] Event line:', line);
                        } else if (line.startsWith('data: ')) {
                            console.log('[TEST] Data line:', line);
                        }
                    }
                    
                    processChunk();
                };
                
                processChunk();
            }).catch(error => {
                console.error('[TEST] Error:', error);
            });
        }
        
        // Test after 1 second
        setTimeout(testStreaming, 1000);
    </script>
</body>
</html>